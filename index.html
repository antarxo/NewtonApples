<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Τα μήλα του Νεύτωνα</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    /* Καμβάς και διάταξη */
    #canvasContainer {
      position: relative;
      width: 800px;
      height: 600px;
    }
    #simulationCanvas {
      width: 100%;
      height: 100%;
      border: 1px solid #333;
      background: url('univ.gif') no-repeat center center;
      background-size: cover;
      display: block;
    }
    /* Τίτλος στο πάνω κέντρο */
    #titleOverlay {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 20px;
      pointer-events: none;
    }
    /* Overlay για τα δεδομένα (μετρητές) πάνω αριστερά */
    #dataOverlay {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 14px;
      pointer-events: none;
    }
    /* Overlay για τους sliders, σε μία σειρά στο κάτω μέρος */
    #slidersOverlay {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
      display: flex;
      justify-content: space-around;
      background: rgba(50, 50, 50, 0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
    }
    .sliderGroup {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .sliderGroup label {
      margin-bottom: 2px;
    }
    .sliderGroup input[type="range"],
    .sliderGroup input[type="number"] {
      width: 80px;
      height: 20px;
      font-size: 12px;
    }
    /* Overlay για τα κουμπιά, στο κάτω δεξιό μέρος */
    #buttonOverlay {
      position: absolute;
      bottom: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
    }
    #buttonOverlay button {
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="canvasContainer">
    <canvas id="simulationCanvas" width="800" height="600"></canvas>
    <div id="titleOverlay">Τα μήλα του Νεύτωνα</div>
    <div id="dataOverlay"></div>
    <div id="slidersOverlay">
      <div class="sliderGroup">
        <label for="heightSlider">Ύψος (km): <span id="heightValueSlider">500,000</span></label>
        <input type="range" id="heightSlider" min="0" max="1000000" step="10000" value="500000">
        <input type="number" id="heightNumber" min="0" max="1000000" step="10000" value="500000">
      </div>
      <div class="sliderGroup">
        <label for="speedSlider">Ταχύτητα (km/s): <span id="speedValueSlider">0,000</span></label>
        <input type="range" id="speedSlider" min="0" max="10000" step="100" value="0">
        <input type="number" id="speedNumber" min="0" max="10000" step="100" value="0">
      </div>
      <div class="sliderGroup">
        <label for="timeStepSlider">Βήμα χρόνου (s): <span id="timeStepValueSlider">0,10</span></label>
        <input type="range" id="timeStepSlider" min="-1" max="3" step="0.1" value="-1">
        <input type="number" id="timeStepNumber" min="0.1" max="6000" step="0.1" value="0.1">
      </div>
      <div class="sliderGroup">
        <label for="massSlider">Μάζα (xΓη): <span id="massValueSlider">1,000</span></label>
        <input type="range" id="massSlider" min="0.1" max="10" step="0.1" value="1">
        <input type="number" id="massNumber" min="0.1" max="10" step="0.1" value="1">
      </div>
    </div>
    <div id="buttonOverlay">
      <button id="startButton">Έναρξη</button>
      <button id="resetButton">Reset</button>
    </div>
  </div>
  
  <script>
    // Σταθερές
    const G = 6.67430e-11;
    const M_earth = 5.972e24;
    const R = 6371000; // σε μέτρα
    
    // Αρχικές τιμές
    let h = 500000; // m
    let v0 = 0;     // m/s
    let dt = 0.1;   // s
    let massMultiplier = 1;
    let running = false;
    let simTime = 0;
    
    // Σύστημα αναφοράς: (0,0) στο κέντρο της Γης. Για καμβά 800x600, το κέντρο είναι (400,300)
    // Μετατοπίζουμε κατακόρυφα προς τα πάνω κατά ~120px (λιγότερο από 1/4 του ύψους του φόντου)
    const earthCenterX = 400;
    const earthCenterY = 300 - 120; // νέο κέντρο: (400, 180)
    
    // Scale: αρχικά R αντιστοιχεί σε 100 px (διάμετρος 200 px)
    let initialScale = R / 100;
    let scale = initialScale;
    
    // Η αρχική θέση του μήλου στο σύστημα αναφοράς: (0, R+h)
    let x = 0;
    let y = R + h;
    let vx = v0;
    let vy = 0;
    
    // Για τα ίχνη, καταγράφουμε μόνο κάθε 3 ενημερώσεις
    let updateCounter = 0;
    let trajectory = []; // αποθηκεύουμε simulation coordinates: { simX, simY }
    
    const canvas = document.getElementById('simulationCanvas');
    const ctx = canvas.getContext('2d');
    
    // Φόρτωση εικόνων
    const appleImg = new Image();
    appleImg.src = 'apple.gif';
    let earthImg = new Image();
    earthImg.src = 'gh.png'; // αρχική εικόνα της Γης
    const backgroundImg = new Image();
    backgroundImg.src = 'univ.gif';
    
    // Αν η μάζα δεν είναι 1, δείξε την εικόνα "other.png"
    function updatePlanetImage() {
      if (parseFloat(document.getElementById('massSlider').value) != 1) {
        earthImg.src = 'other.png';
      } else {
        earthImg.src = 'gh.png';
      }
    }
    
    // Μετατροπή simulation coordinates σε canvas coordinates
    function simToCanvas(simX, simY) {
      return {
        canvasX: earthCenterX + simX / scale,
        canvasY: earthCenterY - simY / scale
      };
    }
    
    // Μορφοποίηση αριθμών με κόμμα ως υποδιαστολή
    function formatNumber(num, decimals) {
      return num.toFixed(decimals).replace('.', ',');
    }
    
    // Μορφοποίηση χρόνου σε hh:mm:ss
    function formatTime(seconds) {
      let hh = Math.floor(seconds / 3600);
      let mm = Math.floor((seconds % 3600) / 60);
      let ss = Math.floor(seconds % 60);
      return (hh < 10 ? '0' + hh : hh) + ':' +
             (mm < 10 ? '0' + mm : mm) + ':' +
             (ss < 10 ? '0' + ss : ss);
    }
    
    // Ενημέρωση overlay δεδομένων (πάνω αριστερά, κάτω από τον τίτλο)
    function updateOverlay() {
      let r = Math.sqrt(x * x + y * y);
      let heightKm = (r - R) / 1000;
      let speedKms = Math.sqrt(vx * vx + vy * vy) / 1000;
      let gVal = getGravity(y);
      document.getElementById('dataOverlay').innerHTML =
        "Χρόνος: " + formatTime(simTime) + "<br>" +
        "Ύψος: " + formatNumber(heightKm, 3) + " km<br>" +
        "Ταχύτητα: " + formatNumber(speedKms, 3) + " km/s<br>" +
        "Βαρύτητα: " + formatNumber(gVal, 3) + " m/s²";
    }
    
    // Σχεδίαση αρχικής κατάστασης
    function drawInitialState() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(backgroundImg, 0, 0, canvas.width, canvas.height);
      let earthSize = 200 * (initialScale / scale);
      ctx.drawImage(earthImg, earthCenterX - earthSize / 2, earthCenterY - earthSize / 2, earthSize, earthSize);
      let pos = simToCanvas(x, y);
      ctx.drawImage(appleImg, pos.canvasX - 2.5, pos.canvasY - 2.5, 5, 5);
      updateOverlay();
    }
    
    // Υπολογισμός βαρυτικής επιτάχυνσης
    function getGravity(y) {
      return (G * (massMultiplier * M_earth)) / (y * y);
    }
    
    // Ενημέρωση προσομοίωσης: πλήρης διανυσματική προσέγγιση
    function updateSimulation() {
      let r = Math.sqrt(x * x + y * y);
      let ax = - (G * (massMultiplier * M_earth)) * (x / (r * r * r));
      let ay = - (G * (massMultiplier * M_earth)) * (y / (r * r * r));
      vx += ax * dt;
      vy += ay * dt;
      x += vx * dt;
      y += vy * dt;
      simTime += dt;
      
      if (Math.sqrt(x * x + y * y) < R) {
        running = false;
        alert('Η προσομοίωση σταμάτησε: το μήλο έπεσε στη Γη.');
      }
      
      let pos = simToCanvas(x, y);
      if (pos.canvasX < 50 || pos.canvasX > canvas.width - 50 ||
          pos.canvasY < 50 || pos.canvasY > canvas.height - 50) {
        scale *= 1.05;
      }
      
      updatePlanetImage();
      updateOverlay();
      
      updateCounter++;
      if (updateCounter % 3 === 0) {
        trajectory.push({ simX: x, simY: y });
        if (trajectory.length > 1000) trajectory.shift();
      }
    }
    
    // Σχεδίαση προσομοίωσης και τροχιάς
    function drawSimulation() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(backgroundImg, 0, 0, canvas.width, canvas.height);
      let earthSize = 200 * (initialScale / scale);
      ctx.drawImage(earthImg, earthCenterX - earthSize / 2, earthCenterY - earthSize / 2, earthSize, earthSize);
      ctx.fillStyle = 'yellow';
      for (let i = 0; i < trajectory.length; i++) {
        let point = simToCanvas(trajectory[i].simX, trajectory[i].simY);
        ctx.beginPath();
        ctx.arc(point.canvasX, point.canvasY, 1, 0, 2 * Math.PI);
        ctx.fill();
      }
      let pos = simToCanvas(x, y);
      ctx.drawImage(appleImg, pos.canvasX - 2.5, pos.canvasY - 2.5, 5, 5);
      updateOverlay();
    }
    
    function simulate() {
      if (!running) return;
      updateSimulation();
      drawSimulation();
      requestAnimationFrame(simulate);
    }
    
    // Toggle κουμπί "Έναρξη"/"Στοπ"
    const startButton = document.getElementById('startButton');
    startButton.addEventListener('click', () => {
      running = !running;
      startButton.textContent = running ? "Στοπ" : "Έναρξη";
      if (running) simulate();
    });
    
    // Κουμπί Reset
    const resetButton = document.getElementById('resetButton');
    resetButton.addEventListener('click', () => {
      running = false;
      simTime = 0;
      h = parseFloat(document.getElementById('heightSlider').value);
      v0 = parseFloat(document.getElementById('speedSlider').value);
      dt = Math.pow(10, parseFloat(document.getElementById('timeStepSlider').value));
      massMultiplier = parseFloat(document.getElementById('massSlider').value);
      x = 0;
      y = R + h;
      vx = v0;
      vy = 0;
      scale = initialScale;
      trajectory = [];
      startButton.textContent = "Έναρξη";
      drawInitialState();
      updateOverlay();
    });
    
    // Σύνδεση sliders και αριθμητικών πεδίων
    const heightSlider = document.getElementById('heightSlider');
    const heightNumber = document.getElementById('heightNumber');
    heightSlider.addEventListener('input', (e) => {
      h = parseFloat(e.target.value);
      document.getElementById('heightValueSlider').innerText = formatNumber(h / 1000, 3);
      heightNumber.value = h;
      y = R + h;
      drawInitialState();
      updateOverlay();
    });
    heightNumber.addEventListener('input', (e) => {
      h = parseFloat(e.target.value);
      document.getElementById('heightValueSlider').innerText = formatNumber(h / 1000, 3);
      heightSlider.value = h;
      y = R + h;
      drawInitialState();
      updateOverlay();
    });
    
    const speedSlider = document.getElementById('speedSlider');
    const speedNumber = document.getElementById('speedNumber');
    speedSlider.addEventListener('input', (e) => {
      v0 = parseFloat(e.target.value);
      document.getElementById('speedValueSlider').innerText = formatNumber(v0 / 1000, 3);
      speedNumber.value = v0;
      vx = v0;
      drawInitialState();
      updateOverlay();
    });
    speedNumber.addEventListener('input', (e) => {
      v0 = parseFloat(e.target.value);
      document.getElementById('speedValueSlider').innerText = formatNumber(v0 / 1000, 3);
      speedSlider.value = v0;
      vx = v0;
      drawInitialState();
      updateOverlay();
    });
    
    const timeStepSlider = document.getElementById('timeStepSlider');
    const timeStepNumber = document.getElementById('timeStepNumber');
    timeStepSlider.addEventListener('input', (e) => {
      let exponent = parseFloat(e.target.value);
      dt = Math.pow(10, exponent);
      document.getElementById('timeStepValueSlider').innerText = formatNumber(dt, 2);
      timeStepNumber.value = dt.toFixed(2);
      drawInitialState();
      updateOverlay();
    });
    timeStepNumber.addEventListener('input', (e) => {
      dt = parseFloat(e.target.value);
      document.getElementById('timeStepValueSlider').innerText = formatNumber(dt, 2);
      let exponent = Math.log10(dt);
      timeStepSlider.value = exponent;
      drawInitialState();
      updateOverlay();
    });
    
    const massSlider = document.getElementById('massSlider');
    const massNumber = document.getElementById('massNumber');
    massSlider.addEventListener('input', (e) => {
      massMultiplier = parseFloat(e.target.value);
      document.getElementById('massValueSlider').innerText = formatNumber(massMultiplier, 3);
      massNumber.value = massMultiplier;
      updatePlanetImage();
      drawInitialState();
      updateOverlay();
    });
    massNumber.addEventListener('input', (e) => {
      massMultiplier = parseFloat(e.target.value);
      document.getElementById('massValueSlider').innerText = formatNumber(massMultiplier, 3);
      massSlider.value = massMultiplier;
      updatePlanetImage();
      drawInitialState();
      updateOverlay();
    });
    
    backgroundImg.onload = () => {
      earthImg.onload = () => {
        appleImg.onload = () => {
          drawInitialState();
          updateOverlay();
        };
      };
    };
  </script>
</body>
</html>
